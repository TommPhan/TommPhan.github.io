"use strict";function string_to_justified_array(e,t,n=9){let a=e.split(""),i=a.length,o=Math.ceil(i/n),r=t.split(" ");if(1===n)return[a,r,1,o];let s=[],l=0,d={new_array:[],width:0,height:0};for(;o>0;o--){let e=n*o;for(let t=0;t<i;t++)n<e&&!(l%o)&&/\s/g.test(a[t])||(/\s/g.test(a[t])?s.push(GAP):s.push(a[t]),l++);if(!(n<e&&l<=e-o)){s[l-1]!==a[i-1]&&(s=d.new_array,o=d.height,n=d.width,l=s.length,e=n*o),s[e-1]=s[e-1]?s[e-1]:GAP,s.fill(GAP,l,e-1);break}d=d.height?d:{new_array:s,width:n-Math.floor((e-l)/o),height:o},s=[]}l=s.length;let c=[];for(let e=0,t=0;e<l;e++){let n="";/\s/.test(s[e])||(n=r[t],t++),c.push(n)}return[s,c,n,o]}function array_to_tbrl_table([e,t,n,a],i=0){let o=document.createElement("table"),r=n*a-a,s=[];for(let l=0;l<a;l++){let d=document.createElement("tr");for(let o=0;o<n;o++){let n=document.createElement("td"),c=document.createElement("div"),h=r+l-a*o;/\s/.test(e[h])?(c.appendChild(document.createTextNode(GAP)),c.setAttribute("style","cursor: default")):(c.addEventListener("click",()=>{context?play_character(e[h],t[h]):console.log("To enable audio in Firefox, type 'about:config' in your browser and set 'dom.webaudio.enabled' to 'true' and reload.")}),c.appendChild(document.createTextNode(e[h])),i&&(c.setAttribute("id",`${i}-${h}`),s.push(h))),n.appendChild(c),d.appendChild(n)}o.appendChild(d)}return CHAPTERS[i]=s.sort((e,t)=>e-t),o}function title(e){let t=["道德經","盜德經","道得經","盜得經"];return TBRLTable(t[e],"dao4 de2 jing1",3)}function array_to_anchors(e){let t=e.length,n=new DocumentFragment;for(let a=0;a<t;a++){let i=document.createElement("div"),o=document.createElement("a"),r=document.createTextNode(e[a][1]);"Guodian"===order&&a>2||("word count"!==order&&"character count"!==order||2!==t?3===t?i.setAttribute("style","background-color: 'dimgrey'"):i.setAttribute("style",`background-color: ${random_colours[a]}`):i.setAttribute("style",`background-color: ${random_colours[0]}`)),i.setAttribute("class","button"),i.appendChild(r),o.setAttribute("href",e[a][0]),o.appendChild(i),n.appendChild(o)}return n}function make_chapter_table([e,t,n]){let a=document.createElement("table");for(var i=0,o=0;i<n;i++){let n=document.createElement("tr");for(let a=0;a<t&&e[o];a++){let t=document.createElement("td");e[o]<MAX+1?t.appendChild(document.createTextNode(e[o])):t.appendChild(document.createTextNode("?")),t.addEventListener("click",e=>to_chapter(e)),t.setAttribute("class","button"),t.setAttribute("style",`background-color: ${chapter_colours[o]}`),n.appendChild(t),o++}a.appendChild(n)}return a}function make_laozi(){let e=material.length,t=MAX/DIVISION,n=0,a=new Array(DIVISION).fill().map(e=>document.createElement("div"));a[0].setAttribute("class","contained"),section_anchors=[];for(let i=1;i<=e;i++){let o=document.createElement("div"),r=document.createElement("h2"),s=document.createElement("div"),l=document.createElement("h3"),d=document.createElement("div"),c=document.createElement("div"),h=material.findIndex(e=>e[order]===i),u=i>1?material.findIndex(e=>e[order]===i-1):0,p=material[h][order];if(o.setAttribute("id",h+1),c.setAttribute("class","chapter"),material[h][`${order}_sections`]&&(material[h][`${order}_sections`]!==material[u][`${order}_sections`]||!h)){let e=material[h][`${order}_sections`].replace(/ *\(*(\d)\)* */g,"");section_anchors.push([`#${h+1}`,material[h][`${order}_sections`].substring(3)]),s.appendChild(document.createTextNode(e)),r.appendChild(s),r.appendChild(document.createTextNode("\n")),o.appendChild(r)}if(!material[h][`${order}_sections`]&&(1===p||p===e)){let e="word count"===order?"Fewest words":"Fewest characters",t="word count"===order?"Most words":"Most characters",n=1===p?e:t;section_anchors.push([`#${h+1}`,n])}l.addEventListener("click",e=>{context?play_chapter(h):console.log("To enable audio in Firefox, type 'about:config' in your browser and set 'dom.webaudio.enabled' to 'true' and reload.")}),d.appendChild(document.createTextNode(material[h]["Fu Yi"])),l.appendChild(d),l.appendChild(document.createTextNode("\n"));let m=document.createElement("div");SHOW.original&&(m.setAttribute("class","original"),m.setAttribute("aria-hidden","true"),m.appendChild(TBRLTable(material[h].original,material[h].pinyin,width,material[h]["Fu Yi"])),m.appendChild(document.createTextNode("\n")));let f=document.createElement("div");if(SHOW.translation){f.setAttribute("class","translation");let e=material[h].translation,t=new DocumentFragment,n=e.replace(/@(.*)/,"").replace(/#/g,"\n\n").split(/(\*+)/),a=n.length;n[a-1]=n[a-1]+"\n";for(let e=0;e<a;e++){if(!SHOW.annotation&&/(\*+)/.test(n[e]))continue;let a="";/(\*+)/.test(n[e])?(a=document.createElement("sup"),a.appendChild(document.createTextNode(n[e].replace(/\*/g,EXTRA))),a.setAttribute("style",`color: ${chapter_colours[h]}`)):a=document.createTextNode(n[e]),t.appendChild(a)}if(f.appendChild(t),SHOW.annotation&&e.includes("@")){let e=document.createElement("small"),t=material[h].translation.replace(/(.*)@/,"\n").replace(/#/g,"\n").split(/(\*+|\(\d+\))/),n=t.length;for(let a=1;a<n;a++){let n="";if(/(\*+)/.test(t[a]))n=document.createElement("sup"),n.appendChild(document.createTextNode(t[a].replace(/\*/g,EXTRA))),n.setAttribute("style",`color: ${chapter_colours[h]}`);else if(/(\(\d+\))/.test(t[a])){let e=t[a].replace(/\D/g,"");n=document.createElement("a"),n.setAttribute("class","button"),n.setAttribute("href",`#${e}`),n.setAttribute("style",`font-style: normal; background-color: ${chapter_colours[e-1]}`),n.appendChild(document.createTextNode(`${GAP}${e}${GAP}`))}else n=document.createTextNode(t[a]);e.appendChild(n)}f.appendChild(document.createTextNode("\n")),f.appendChild(e)}f.appendChild(document.createTextNode("\n"))}if(s.setAttribute("style",`color: white;\n      background-color: ${chapter_colours[h]};\n      width: fit-content;\n      width: -moz-fit-content;\n      min-width: 2.2rem;\n      margin: 0 auto;\n      padding: 0.3rem 0.8rem;\n      border-radius: 24px;`),d.setAttribute("style",`color: white;\n      background-color: ${chapter_colours[h]};\n      width: 2.2rem;\n      margin: 0 auto;\n      padding: 0 0.6rem;\n      line-height: 2rem;\n      border-radius: 24px;`),c.appendChild(l),SHOW.original&&c.appendChild(m),SHOW.translation&&c.appendChild(f),SHOW.annotation&&("Guodian"===order&&p<32||"Mawangdui"===order)){let e=document.createElement("small"),t=`${order}: ${"Guodian"===order&&p>13?p+1:p}\n\n`;e.appendChild(document.createTextNode(t)),c.appendChild(e)}o.appendChild(c),a[n].appendChild(o),!(i%t)&&i<e&&(n++,a[n].setAttribute("class","contained"))}let i=document.createElement("h2");i.appendChild(document.createTextNode("Chapters\n\n"));let o=make_sorter();o.setAttribute("style","padding-top: 6rem;");let r=document.createElement("div"),s=make_chapter_table([make_chapter_array(),width,Math.ceil((MAX+1)/width)]);r.setAttribute("class","chapter_table"),r.setAttribute("style","padding: 1rem 1rem 0"),r.appendChild(s),r.appendChild(document.createTextNode("\n"));let l=document.createElement("div");l.setAttribute("class","page_sections"),l.appendChild(array_to_anchors(section_anchors)),l.appendChild(document.createTextNode("\n"));let d=document.createElement("form"),c=document.createElement("div"),h=document.createElement("div"),u=document.createElement("label"),p=document.createElement("label"),m=document.createElement("label");return u.appendChild(document.createTextNode("*...")),p.appendChild(document.createTextNode("English")),m.appendChild(document.createTextNode("中文")),u.setAttribute("id","annotation"),p.setAttribute("id","translation"),m.setAttribute("id","original"),u.setAttribute("style",`font-weight: ${SHOW.annotation?"bold":"normal"};`),p.setAttribute("style",`font-weight: ${SHOW.translation?"bold":"normal"};`),m.setAttribute("style",`font-weight: ${SHOW.original?"bold":"normal"};`),u.setAttribute("title","annotation"),p.setAttribute("title","translation"),m.setAttribute("title","original"),h.appendChild(document.createTextNode("Showing for each chapter")),d.appendChild(h),d.appendChild(m),d.appendChild(p),d.appendChild(u),d.setAttribute("style","padding: 8rem 1rem;"),d.addEventListener("click",e=>{let t=e.target.id;SHOW[t]=!SHOW[t],replace_children()}),c.appendChild(d),c.setAttribute("class","contained"),a[0].prepend(c),a[0].prepend(l),a[0].prepend(r),a[0].prepend(o),a[0].prepend(i),a}function make_menu(){let e=document.createElement("div"),t=document.createElement("div");t.appendChild(array_to_anchors(main_anchors)),t.setAttribute("style","padding-bottom: 0;"),e.setAttribute("class","horizontal_menu"),e.setAttribute("style","overflow-x: hidden;"),e.appendChild(t);let n=document.createElement("div"),a=make_chapter_table([make_chapter_array(),width,Math.ceil((MAX+1)/width)]);n.setAttribute("class","chapter_table"),n.appendChild(a);let i=document.createElement("div"),o=document.createElement("div");o.appendChild(array_to_anchors(section_anchors)),i.setAttribute("class","horizontal_menu"),i.appendChild(o);let r=document.createElement("div");return r.setAttribute("id","menu_inner"),r.setAttribute("class","round contained"),r.appendChild(e),r.appendChild(n),r.appendChild(i),r.appendChild(make_sorter()),r}function make_sorter(){let e=document.createElement("form"),t=document.createElement("select"),n=new DocumentFragment;return orders.forEach(e=>{let t=document.createElement("option");t.appendChild(document.createTextNode(e)),e===ORDER&&t.setAttribute("selected","selected"),n.appendChild(t)}),t.appendChild(n),e.appendChild(document.createTextNode(`Sorting by${GAP}`)),e.appendChild(t),e.addEventListener("change",change_order),e}function colourise_chapters(){const e=["#2e5a85","#375f52","#0052b9","#7b2bc3","#5f5566","#8c3c72","#7c4a4b","#4e3cda","#465875","#2a6233","#005f7c","#4f547c","#9a353a"];let t="";if(random_colours=random_order().map(t=>e[t]),t=random_colours[0],"word count"===order||"character count"===order)return void(chapter_colours=new Array(MAX).fill().map(()=>t));let n=[...new Set(material.map(e=>e[`${order}_sections`]))].sort();for(let e=0;e<MAX;e++){let a=material[e][`${order}_sections`];t="Guodian"!==order||"04 Absent upper (21)"!==a&&"05 Absent lower (29)"!==a?random_colours[n.indexOf(a)]:"dimgrey",chapter_colours[e]=t}}function load_buffer(e){let t=0;return new Promise(n=>{e in buffers&&n(buffers[e]);let a=new XMLHttpRequest,i=`sound/${e}.mp3`;a.open("GET",i,!0),a.responseType="arraybuffer",a.onload=(()=>{context.decodeAudioData(a.response,t=>{buffers[e]=t,n(t)},()=>{console.log("Buffer not loaded. To retry."),t++,t<10&&load_buffer(e)})}),a.send()})}function karaoke(e,t){let n=document.getElementById(`${e}-${t}`);n.setAttribute("style","font-weight: bold;"),setTimeout(()=>n.setAttribute("style","font-weight: normal;"),100)}function play(e,t=0,n,a){"suspended"===context.state&&context.resume();let i=context.createBufferSource();sources[t]=i,load_buffer(e).then(e=>{i.buffer=e,i.connect(context.destination),i.start(t,0,1),i.onended=(()=>{n&&SHOW.original&&karaoke(n,CHAPTERS[n][a]),delete sources[t]})})}function stop_sound(){context.suspend().then(()=>{Object.keys(sources).forEach(e=>sources[e].stop()),context.resume()})}function play_sequence(e,t,n){if(Object.keys(sources).length)return void stop_sound();let a=e.split(" ");Promise.all([a.map(e=>load_buffer(e))]).then(()=>{let e=a.length,i=t.split("").map(Number),o=.2,r=.5,s=context.currentTime+r;for(let t=0;t<e&&a[t];t++){let e=s+t*o,r=i[t]-1;play(a[t],e,n,t),s+=r*o}})}function original_to_rhythm(e){let t=e.split(""),n="";for(let[e]of t.entries()){if(/\s/.test(t[e]))continue;let a=1;/\s/.test(t[e+1])&&(a++,/\s/.test(t[e+2])&&a++),n+=a}return n}function play_character(e,t){let n=glyphs.filter(t=>t.character===e)[0].pinyin,a=glyphs.filter(t=>t.character===e)[0].frequency_rank,i=a<270?"Common":a<540?"Less common":a<811?"Rare":null;console.log(`Character: ${e}\nPinyin: ${n} (${t})\nRarity: ${a}/810 (${i})\nDefinition:\nhttps://www.zdic.net/hans/${e}\nhttps://dict.baidu.com/s?wd=${e}\nhttps://www.moedict.tw/'${e}`),play(t)}function play_chapter(e){let t=material[e],n=t.pinyin,a=original_to_rhythm(t.original),i=t.original.replace(/  /g,"\n"),o=t.translation.replace(/@(.*)/,"").replace(/#/g,"\n\n").replace(/(\*+)/g,""),r=chinese_number(e+1);console.log(`老子 〈傅奕古本 第${r}章〉\n\n${i}\n  \nLaozi (Fu Yi's Ancient Copy, Chapter ${e+1})\n\n${o}`),play_sequence(n,a,e+1)}function chinese_number(e){const t=["一","二","三","四","五","六","七","八","九","十"],n=t[9];e+="";let a=e.length>1?"1"!==e.substr(-2,1)?t[e.substr(-2,1)-1]+n:n:"",i="0"!==e.substr(-1,1)?t[e.substr(-1,1)-1]:"",o=a+i;return o}function replace_child(e,t){let n=document.getElementById(t);n.replaceChild(e,n.firstElementChild)}function replace_children(){width=get_width();for(let e=0;e<DIVISION;e++)e?replace_child(make_laozi()[e],`laozi${e+1}`):replace_child(make_laozi()[0],"chapters");replace_child(make_menu(),"menu"),document.getElementById("extra").innerHTML=`<div class="inner contained"><h2>Extra</h2>\n  <h4>What is the correct way of spelling Laozi?</h4>\n  <p>Laotzu, Laotzyy, Laozi are all romanisations of the same sequence of characters, 老子 - none is more correct than others. The Pinyin spelling has been chosen on the basis that Pinyin is currently the most widely taught and supported romanisation system.\n\n<table class="small_table">\n  <tr><th>Original</th><td>老子</td><td>道德經</td><td>天地</td></tr>\n  <tr><th>Wade-Giles</th><td>lao3 tzu3</td><td>tao4 te2 ching1</td><td>t'ien1 ti4</td></tr>\n  <tr><th>Gwoyeu romatzyh</th><td>lao tzyy</td><td>daw der jing</td><td>tian dih</td></tr>\n  <tr><th>Hanyu pinyin</th><td>lǎo zǐ</td><td>dào dé jīng</td><td>tiān dì</td></tr>\n  <tr><th>Translation</th><td>Master Lao\n/\nThe elder master.</td><td>Classical Texts on Path & Virtue\n/\nClassic on Virtue in the Path.</td><td>The heaven and the earth.</td></tr>\n  </table>\n  </p><h4>Your original text looks a little different from mine</h4>\n  <p>This version happens to be a reconstruction by Fu Yi (傅奕, a grand historian in the Tang dynasty) from the earliest surviving copy of Laozi known to him. This copy is reportedly excavated in 574 from the tomb of Consort Yu (虞姬, birth name unknown), spouse of Xiang Yu (項羽). It shares a little more textual familiarity with the oldest verifiable copies than other received texts.</p>\n  <h4>Did Laozi really sound like that?</h4>\n  <p>Since Laozi was written in a time when Old Chinese was spoken, it probably sounded a lot closer to Southern Min or Hokkien than Mandarin. Fortunately, there has not been so much divergence that the intended levity and lyricism are completely lost - most of the important homophonic puns do work in Mandarin.</p>\n  <h4>Is it disrespectful to Chinese culture to read Laozi without spiritualism?</h4>\n  <p>No, a healthy number of Chinese sceptics have existed alongside the development of Daoism, which gradually assimilated the cosmology, the longevity and immortality rituals, and the traditions of shamans (巫) and formula-bearing specialists (方士). The following quotes Gu Yong (谷永, minister to Emperor Cheng of Han) on the matter.\n\n  <small><b>Doctors, Diviners, and Magicians of Ancient China: Biographies of Fang-shih - Kenneth J. DeWoskin:</b>\nAll those occultists, who turn their backs on the right path of benevolence and correct duty, who do not revere the model of the Five Classics but who rather are brimming with claims about the strange and marvelous, about spirits and ghosts, who stand in unquestioning reverence of the sacrificial practices of every locale, who seek rewards from shrines without good fortune to offer, who say that immortals are to be found in this world and who imbibe all manner of longevity drugs, who capriciously set out on distant quests and travel so high that their shadows are cast upwards, [i. e., fly over the top of the sun], who scan the world for Hsien-p'u and drift about in search of P'eng-lai, who rotate the planting of grain in mysterious conjunction with the Five Powers, and who sow and reap in cadence with the daily sun, who rival the mountain's stones in longevity, who have mastered the transformation of base metal to gold, who have made uniform the five colors and five stores within their bodies - those occultists cheat people and delude the masses.</small>\nThe following says of Fu Yi's distrust of the magic-influenced practitioners of his time some 600 years later.\n\n  <small><b>Old Book of Tang - Liu Xu (舊唐書 - 劉昫)</b>:\nPrior to his death, he warned his children, 'The truly profound chapters of Lao and Zhuang and the doctrines within the Six Classics of Zhou and Confucius are highly regarded teachings - you should study those. The demonic and barbaric corruption of Chinese principles that is being promoted serve only to misguide the masses. I alone sigh as the masses, tragically, do not see it as I do. All of you should refrain from studying those. The ancients were buried naked - you should act the same way.' Despite tending to fall ill, Fu Yi, in his life, never sought a doctor or took medicine. Despite having mastered the book of Yin Yang divination and numerology, he was not a believer.</small></p>\n  <h4>How do Penrose stairs work as an analogy to Laozi's path?</h4>\n\n<p><table class="small_table"><tr><th>道</th><th>Penrose stairs</th></tr><tr><td>道可道 非常道\n  名可名 非常名\n  <a class="button" href="#1" style="font-style: normal; background-color: ${chapter_colours[0]}">&nbsp;1&nbsp;</a></td><td>Cannot be expressed physically.</td><tr><td>故有 無之相生\n  難 易之相成\n  <a class="button" href="#2" style="font-style: normal; background-color: ${chapter_colours[1]}">&nbsp;2&nbsp;</a></td><td>Shows the interdependence between direct opposites which are meaningless without each other.</td><tr><td>吾不知其名 故彊字之曰道 彊為之名曰大\n  大曰逝 逝曰遠 遠曰返\n  <a class="button" href="#25" style="font-style: normal; background-color: ${chapter_colours[24]}">&nbsp;25&nbsp;</a></td><td>Imagines an impossibly big loop by generalising negation to one fixed direction in space which somehow leads back to the source.</td><tr><td>故善人者 不善人之師 \n  不善人者 善人之資\n  <a class="button" href="#27" style="font-style: normal; background-color: ${chapter_colours[26]}">&nbsp;27&nbsp;</a></td><td>Describes the absence of hierarchy between direct opposites which are given equal prominence.</td><tr><td>明道若昧 夷道若纇 進道若退\n  <a class="button" href="#41" style="font-style: normal; background-color: ${chapter_colours[40]}">&nbsp;41&nbsp;</a></td><td>Bears the features of a literal path.</td><tr></tr><td>禍兮 福之所倚\n  福兮 禍之所伏\n  孰知其極\n  其無正 袤正復為奇 善復為䄏\n  <a class="button" href="#58" style="font-style: normal; background-color: ${chapter_colours[57]}">&nbsp;58&nbsp;</a></td><td>Draws no absolute boundaries since any two points on the loop are defined by their relative difference.</td><tr></table>\n\n<h5>Non-having & having\n\n</h5><p style="font-size: 1.1rem; text-align: center;">Conventional and finite:\nHaving is <s>not not</s> having. <i>Not having</i> is <s>not not</s> <i>not having</i>.\n\nParadoxical and infinite:\nHaving is <i>not having</i> is <s>not not</s> having is <s>not not</s> <i>not having</i> is <s>not not not not</s> having...</p>\n\n<h5>Generalisation\n\n</h5><div id="having" style="height: 24rem;"><div><table class="small_table" style="text-align: center;"><tr><td></td><td>To</td><td>have action</td><tr><td>is</td><td>to not</td><td>have action</td></tr><tr><td>is</td><td>to <s>not not</s></td><td>have action</td></tr></table>\n為無為則無不為矣\n<a class="button" href="#3" style="font-style: normal; background-color: ${chapter_colours[2]}">&nbsp;3&nbsp;</a>\n\n</div></div><h4>How does virtue relate to the path?</h4>\n\n<h5>To attain & to gain\n\n</h5><table class="small_table">\n  <tr><th>其</th><th>德</th><th>得</th></tr><tr><th>無</th><td>得</td><td>德</td></tr><tr><th>有</th><td>德</td><td>得</td></tr></table>\n\n<h5>Sufficiency & authenticity\n\n</h5><table class="small_table"><tr><th></th><th>有</th><th>無</th></tr><tr><th>德</th><td>足:\n為天下谷 常德乃足 復歸於樸\n  <a class="button" href="#28" style="font-style: normal; background-color: ${chapter_colours[27]}">&nbsp;28&nbsp;</a></td><td>信:\n上德不德 是以有德\n  <a class="button" href="#38" style="font-style: normal; background-color: ${chapter_colours[37]}">&nbsp;38&nbsp;</a></td></tr><tr><th>得</th><td>信:\n不信者 吾亦信之 得信矣\n  <a class="button" href="#49" style="font-style: normal; background-color: ${chapter_colours[48]}">&nbsp;49&nbsp;</a></td><td>足:\n咎莫憯於欲得\n  <a class="button" href="#25" style="font-style: normal; background-color: ${chapter_colours[24]}">&nbsp;25&nbsp;</a></td></tr></table>\n\n<h5>Non-action & action\n\n</h5><table class="small_table">\n  <tr><th>為</th><th>德</th><th>得</th></tr><tr><th>無</th><td>To attain substantially\nis to understand authenticity\nand to understand sufficiency</td><td>To gain substantially\nis to understand sufficiency\nand to understand authenticity</td></tr><tr><th>有</th><td>To attain negligibly\nis to not understand authenticity\nand to understand sufficiency</td><td>To gain negligibly\nis to not understand sufficiency\nand to understand authenticity</td></tr></table>\n\n<h5>Generalisation\n\n</h5><div id="virtue" style="height: 13rem;"><table class="small_table" style="text-align: center;"><tr><td></td><td>To</td><td>attain</td><tr><td>is</td><td>to not</td><td>attain</td></tr><tr><td>is</td><td>to <s>not not</s></td><td>attain</td></tr><tr><td>authentically</td></tr></table>\n</div></div>`}function change_order(e){ORDER=e.target.value,order=ORDER.replace(/.*: /,""),colourise_chapters(),replace_children()}function glitch(e){phase_step>PHASE_INTERVAL?(replace_child(title(0),"title"),phase_step=0):phase_step>STABLE_BAR&&e-last>UPDATE_INTERVAL&&(replace_child(title(random_number(4)),"title"),last=e),phase_step++,requestAnimationFrame(glitch)}function stairs(e){const t=document.getElementById("art");e-stairs_last>300&&(stairs_last=e,"P"===t.firstChild.wholeText[698]?t.innerHTML=stairs2:t.innerHTML=stairs1),requestAnimationFrame(stairs)}function having_table(e){function t(e,t,n){const a=chapter_colours[e-1],i=document.createElement("div");return i.innerHTML=`<table class="small_table" style="text-align: center;"><tr><td></td><td>To</td><td>have ${n}</td><tr><td>is</td><td>to not</td><td>have ${n}</td></tr><tr><td>is</td><td>to <s>not not</s></td><td>have ${n}</td></tr></table>\n${t}\n<a class="button" href="#${e}" style="font-style: normal; background-color: ${a}">&nbsp;${e}&nbsp;</a>\n\n`,i}const n=[[3,"為無為則無不為矣","action"],[7,"不以其無私耶 故能成其私","self-benefit"],[38,"上德不德 是以有德","virtue"],[16,"凡物紜紜 各歸其根\n歸根曰靖 靖曰復命\n復命曰常 知常曰明","constancy"],[61,"或下以取 或下而取","conquest"],[63,"是以聖人猶難之 故終無難矣","ease"],[76,"故堅彊處下 柔弱處上","strength"],[4,"道盅而用之又不滿\n淵兮 似萬物之宗","significance"],[22,"古之所謂曲則全者 豈虛言也哉\n誠全而歸之","completion"],[2,"天下皆知美之為美斯惡已\n皆知善之為善斯不善已","unity"],[47,"其出镾遠 其知镾尟","occupation"],[37,"道常無為而無不為\n王侯若能守 萬物將自化","leadership"]];if(e-having_last>3e3){having_last=e,having_step=n.length-1>having_step?++having_step:0;const a=n[having_step];replace_child(t(a[0],a[1],a[2]),"having")}requestAnimationFrame(having_table)}function virtue_table(e){function t(e,t,n,a){const i=document.createElement("div");return i.innerHTML=`<table class="small_table" style="text-align: center;"><tr><td></td><td>To</td><td>${e}</td><tr><td>is</td><td>to not</td><td>${t}</td></tr><tr><td>is</td><td>to <s>not not</s></td><td>${n}</td></tr><tr><td>${a}</td></tr></table>`,i}const n=[["attain","attain","attain","authentically"],["attain","gain","attain","sufficiently"],["gain","attain","attain","authentically"],["gain","gain","attain","sufficiently"],["attain","attain","gain","authentically"],["attain","gain","gain","sufficiently"],["gain","attain","gain","authentically"],["gain","gain","gain","sufficiently"]];if(e-virtue_last>6e3){virtue_last=e,virtue_step=7>virtue_step?++virtue_step:0;const a=n[virtue_step];replace_child(t(a[0],a[1],a[2],a[3]),"virtue")}requestAnimationFrame(virtue_table)}function to_chapter(e){e.preventDefault();let t=e.target.innerText;location.href="?"===t?`#${random_number(MAX)+1}`:`#${t}`}function make_fold(){let e=document.createElement("div"),t=document.createElement("h1"),n=document.createElement("h1"),a=document.createElement("h1"),i=document.createElement("h1");t.appendChild(TBRLTable("老子","lao2 zi3",1)),n.appendChild(title(0)),n.setAttribute("id","title"),a.appendChild(TBRLTable("五千言","wu3 qian1 yan2",1)),i.appendChild(document.createTextNode("Laozi Recited")),e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(i);let o=document.createElement("pre");o.appendChild(document.createTextNode(stairs1)),o.setAttribute("id","art"),o.setAttribute("style","height: 224px; font-size: 5px; line-height: 8px; margin: 0 0 4rem; cursor: default;"),e.appendChild(o);let r=document.createElement("p");r.setAttribute("style","text-align: center; font-size: 1rem; margin: 0 1rem 1rem;"),r.appendChild(document.createTextNode("Hop to any section from the bottom-right menu")),e.appendChild(r);let s=document.createElement("div");s.setAttribute("class","menu_icon round"),s.setAttribute("style","margin: 0 auto 4rem;"),s.appendChild(document.createTextNode("☰")),e.appendChild(s);let l=document.createElement("p");l.setAttribute("style","text-align: center; font-size: 1rem; margin: 0 1rem 1rem;"),l.appendChild(document.createTextNode("Press any big chapter button to stop a running audio")),e.appendChild(l);let d=document.createElement("h3"),c=document.createElement("div");d.setAttribute("style","padding: 0;"),c.setAttribute("style","color: white;\n  background-color: dimgrey;\n  width: 2.2rem;\n  margin: 0 auto 4rem;\n  padding: 0 0.6rem;\n  line-height: 2rem;\n  border-radius: 24px;"),c.appendChild(document.createTextNode("0")),d.appendChild(c),e.appendChild(d);let h=document.createElement("div"),u=array_to_anchors(main_anchors);h.setAttribute("class","page_sections"),h.setAttribute("style","margin: 10rem 0 6rem;"),h.appendChild(document.createTextNode("\n")),h.appendChild(u),h.appendChild(document.createTextNode("\n")),e.appendChild(h);let p=document.createElement("div");return p.setAttribute("class","inner contained"),p.innerHTML="<h2>Reliability notes</h2>\n  <h4>For Mandarin learners</h4>\n  <ul><li>Laozi is written in Classical Chinese. Without a separate plan to ground your understanding of Mandarin alongside the use of this website as a resource, at best, you will be learning some 810 Chinese characters and using them in archaic syntax in niche situations.</li>\n  <li>The pronunciation of each word is context-specific - the same character appearing in a different sequence can have a different pronunciation due to a tone change or an alternative meaning. On a desktop browser, press F12 to open up the Console. Clicking on a word displays in the Console both the neutral Pinyin and the one associated with the audio in parenthesis.</li>\n  <li>As per the conventional treatment of Chinese texts, where there is an option for literary or vernacular pronunciation for a word, the literary one is chosen.</li>\n  <li>This version of Laozi uses many loanwords, some of which are very archaic. Save for a few characters that are not modern-font-safe (949: 𧶀, 1228: 𠔃, 3772: 疏), they have not been substituted by other glyphs. The stabilised spelling of a loanword can be found in its respective Zdic page linked to in the Console.</li>\n  <li>Sorting by character count can give you better control over your exposure to new vocabulary.</li></ul>\n  <h4>For new readers</h4>\n  <ul><li>This translation assumes that - notwithstanding the later history of textual transformation - all chapters of the received text have been conceived through the authorship of one body. The reason being that it is more plausible to consider a work of this brevity and level of consistency in style and core ideas to have been the product of a single early source than the product of carefully coordinated co-authorship and compilation over a long period of time with limited means of communication.\n\nThis assumption shapes the reading of the text in a way that departs from others that take a different view, with some translations and commentaries either leaving internally conflicting interpretation unresolved or rejecting chapters outright.</li>\n  <li>There is prioritising of the focusing of concepts and its resulting thematic cohesion over idiomaticity - the importance of these concepts being determined by their relation to the centralising having/not having theme. These concepts may therefore differ from those that others deem more major and noteworthy.\n\nFor example, for '難得', 'difficult to gain' is preferred over 'valuable' - difficulty and gaining being recurring themes that need to be, as in the original text, exposed and recognisable in the same form each time they appear.</li>\n  <li>Genericity is maximised where possible. For example, in the appearances of '觀' where the association with sightedness is minimal and incidental, the more inclusive 'discern' is preferred; in the appearances of '王', 'monarch' suffices contextually without specifying sex.\n\nThe use of neutral pronouns reflects the wideness in application of the statements in the original text and keeps with the emphasis on commonalities - such as the common ability to experience ups and downs - across individuals, bodies of authority, flora and fauna, and inanimate entities.</li>\n  <li>The language lends itself to multiple interpretation. Take for example a relatively textually stable expression, '渙若冰將釋', which attempts to describe the ancient practitioners of the path. Lin Yutang's 'Self-effacing, like ice beginning to melt' comments on the quality of self. Chan Wing-Tsit's 'Supple and pliant, like ice about to melt' likens the behaviour of the sages to that of water. Lau Din-Cheuk's 'Falling apart like the thawing ice' focuses on the quality of transience. They differ from one another without being incorrect because the original expression captures all of those sentiments simultaneously.\n\nThe flexibility of Classical Chinese is such that - like music, which is able to capture the mood of an entire era in a clip of a few seconds - it is both a strength and a weakness; music, by relying on abstractness for its strength, being terribly imprecise as a documenting tool.\n\nAs such, even the translations of scholarly-minded giants can differ greatly from that of a philosopher as respected as Wang Bi (王弼) in his reasoned interpretation of '兩者', his consistent treatment of implicit subjects as the ruler, and his readings of compounds like '芻狗' and '橐籥'.</li>\n  <li>Readers who find the translation unacceptable are welcome to continue to use the website without it, be it as a pronunciation checker or a visualisation of alternative sorting orders.\n\nFor reading your favourite translation or making your own translation with, the closest to an interpretation-free experience can be achieved by turning off the translation and annotation, leaving just the original text with punctuations added for readability.\n  </li></ul>\n  ",e.appendChild(p),e.setAttribute("class","contained"),e}const TBRLTable=(e,t,n,a)=>array_to_tbrl_table(string_to_justified_array(e,t,n),a),make_chapter_array=(e=1,t=82)=>Array(t-e+1).fill().map((t,n)=>e+n),random_number=e=>Math.floor(Math.random()*e),random_order=()=>{let e=13,t=13,n=[];for(let a=0;a<t;a++){let t=0;do{t=random_number(e)}while(n.includes(t));n.push(t)}return n},get_width=()=>{let e=9,t=8,n=Math.min(t,Math.floor((screen_width-320)/30));return e+n};let screen_width=320,width=9,timeout=0;const DELAY=10,UPDATE_INTERVAL=100,PHASE_INTERVAL=300,STABLE_BAR=200;let phase_step=0,last=0,stairs_last=0,having_last=0,having_step=0,virtue_last=0,virtue_step=0;const MAX=81,GAP=" ",EXTRA="*",SHOW={annotation:!0,translation:!0,original:!0},DIVISION=1,MENU=document.getElementById("menu"),CHAPTERS=new Array(MAX),orders=["theme","word count","character count","<278 BCE: Guodian","<202 BCE: Fu Yi","<168 BCE: Mawangdui"]
;let context,ORDER=orders[4],order=ORDER.replace(/.*: /,""),section_anchors=[["#1",material[0]["Fu Yi_sections"].substring(3)],["#38",material[37]["Fu Yi_sections"].substring(3)]],main_anchors=[["#","Top"],["#chapters","Chapters"],["#extra","Extra"]],random_colours=[],chapter_colours=[];try{context=new AudioContext({latencyHint:"interactive",sampleRate:8e3})}catch(e){console.log("To enable audio in Firefox, type 'about:config' in your browser and set 'dom.webaudio.enabled' to 'true'")}let buffers={},sources={};window.addEventListener("resize",()=>{let e=window.innerWidth;screen_width=e,clearTimeout(timeout),timeout=setTimeout(()=>{replace_children()},DELAY)}),window.addEventListener("load",()=>{let e=window.innerWidth;screen_width!==e&&(screen_width=e,replace_children())}),document.getElementById("menu_icon").addEventListener("click",()=>{MENU.style.visibility="hidden"===MENU.style.visibility||""===MENU.style.visibility?"visible":"hidden"}),document.getElementById("fold").addEventListener("click",()=>{MENU.style.visibility="hidden"});for(let e=1;e<DIVISION;e++)document.getElementById(`laozi${e+1}`).addEventListener("click",()=>{MENU.style.visibility="hidden"});document.getElementById("chapters").addEventListener("click",()=>{MENU.style.visibility="hidden"}),document.getElementById("extra").addEventListener("click",()=>{MENU.style.visibility="hidden"}),replace_child(make_fold(),"fold"),colourise_chapters(),replace_children(),glitch(),stairs(),having_table(),virtue_table();
