"use strict";function string_to_justified_array(e,t,n=9){let a=e.split(""),i=a.length,o=Math.ceil(i/n),r=t.split(" ");if(1===n)return[a,r,1,o];let s=[],l=0,d={new_array:[],width:0,height:0};for(;o>0;o--){let e=n*o;for(let t=0;t<i;t++)n<e&&!(l%o)&&/\s/g.test(a[t])||(/\s/g.test(a[t])?s.push(GAP):s.push(a[t]),l++);if(!(n<e&&l<=e-o)){s[l-1]!==a[i-1]&&(s=d.new_array,o=d.height,n=d.width,l=s.length,e=n*o),s[e-1]=s[e-1]?s[e-1]:GAP,s.fill(GAP,l,e-1);break}d=d.height?d:{new_array:s,width:n-Math.floor((e-l)/o),height:o},s=[]}l=s.length;let c=[];for(let e=0,t=0;e<l;e++){let n="";/\s/.test(s[e])||(n=r[t],t++),c.push(n)}return[s,c,n,o]}function array_to_tbrl_table([e,t,n,a],i=0){let o=document.createElement("table"),r=n*a-a,s=[];for(let l=0;l<a;l++){let d=document.createElement("tr");for(let o=0;o<n;o++){let n=document.createElement("td"),c=document.createElement("div"),h=r+l-a*o;if(/\s/.test(e[h]))c.appendChild(document.createTextNode(GAP)),c.setAttribute("style","cursor: default");else{if(c.addEventListener("click",()=>{context?play_character(e[h],t[h]):console.log("To enable audio in Firefox, type 'about:config' in your browser and set 'dom.webaudio.enabled' to 'true' and reload.")}),c.appendChild(document.createTextNode(e[h])),SHOW.pinyin&&t.length>3){let e=document.createElement("div");e.setAttribute("style","font-size: 0.7rem; margin: 0.1rem 0; line-height: 0;"),e.appendChild(document.createTextNode(tone_to_accent(t[h]))),c.appendChild(e)}i&&(c.setAttribute("id",`${i}-${h}`),s.push(h))}n.appendChild(c),d.appendChild(n)}o.appendChild(d)}return CHAPTERS[i]=s.sort((e,t)=>e-t),o}function title(e){let t=["道德經","盜德經","道得經","盜得經"];return TBRLTable(t[e],"dao4 de2 jing1",3)}function array_to_anchors(e){let t=e.length,n=new DocumentFragment;for(let a=0;a<t;a++){let i=document.createElement("div"),o=document.createElement("a"),r=document.createTextNode(e[a][1]);"Guodian"===order&&a>2||("word count"!==order&&"character count"!==order||2!==t?t!==main_anchors.length||/\(/.test(e[a])?i.setAttribute("style",`background-color: ${random_colours[a]}`):i.setAttribute("style","background-color: 'dimgrey'"):i.setAttribute("style",`background-color: ${random_colours[0]}`)),i.setAttribute("class","button"),i.appendChild(r),o.setAttribute("href",e[a][0]),o.appendChild(i),n.appendChild(o)}return n}function make_chapter_table([e,t,n]){let a=document.createElement("table");for(var i=0,o=0;i<n;i++){let n=document.createElement("tr");for(let a=0;a<t&&e[o];a++){let t=document.createElement("td");e[o]<MAX+1?t.appendChild(document.createTextNode(e[o])):t.appendChild(document.createTextNode("?")),t.addEventListener("click",e=>to_chapter(e)),t.setAttribute("class","button"),t.setAttribute("style",`background-color: ${chapter_colours[o]}`),n.appendChild(t),o++}a.appendChild(n)}return a}function make_laozi(){const e=material.length,t=MAX/DIVISION,n=0,a=new Array(DIVISION).fill().map(e=>document.createElement("div"));a[0].setAttribute("class","contained"),section_anchors=[];for(let i=1;i<=e;i++){let o=document.createElement("div"),r=document.createElement("h2"),s=document.createElement("div"),l=document.createElement("h3"),d=document.createElement("div"),c=document.createElement("div"),h=material.findIndex(e=>e[order]===i),u=i>1?material.findIndex(e=>e[order]===i-1):0,p=material[h][order];if(o.setAttribute("id",h+1),c.setAttribute("class","chapter"),material[h][`${order}_sections`]&&(material[h][`${order}_sections`]!==material[u][`${order}_sections`]||!h)){let e=material[h][`${order}_sections`].replace(/ *\(*(\d)\)* */g,"");section_anchors.push([`#${h+1}`,material[h][`${order}_sections`].substring(3)]),s.appendChild(document.createTextNode(e)),r.appendChild(s),r.appendChild(document.createTextNode("\n")),o.appendChild(r)}if(!material[h][`${order}_sections`]&&(1===p||p===e)){let e="word count"===order?"Fewest words":"Fewest characters",t="word count"===order?"Most words":"Most characters",n=1===p?e:t;section_anchors.push([`#${h+1}`,n])}l.addEventListener("click",e=>{context?play_chapter(h):console.log("To enable audio in Firefox, type 'about:config' in your browser and set 'dom.webaudio.enabled' to 'true' and reload.")}),d.appendChild(document.createTextNode(material[h]["Fu Yi"])),l.appendChild(d),l.appendChild(document.createTextNode("\n"));let m=document.createElement("div");SHOW.original&&(m.setAttribute("class","original"),m.setAttribute("aria-hidden","true"),m.appendChild(TBRLTable(material[h].original,material[h].pinyin,width,material[h]["Fu Yi"])),m.appendChild(document.createTextNode("\n")));let g=document.createElement("div");if(SHOW.translation){g.setAttribute("class","translation");let e=material[h].translation;if(SHOW.annotation&&e.includes("@")){let e=document.createElement("small"),t=material[h].translation.replace(/(.*)@/,"\n").replace(/#/g,"\n").split(/(\*+|\(\d+\))/),n=t.length;for(let a=1;a<n;a++){let n="";if(/(\*+)/.test(t[a]))n=document.createElement("sup"),n.appendChild(document.createTextNode(`[${t[a].length}] `)),n.setAttribute("style",`color: ${chapter_colours[h]}`);else if(/(\(\d+\))/.test(t[a])){let e=t[a].replace(/\D/g,"");n=document.createElement("a"),n.setAttribute("class","button_small"),n.setAttribute("href",`#${e}`),n.setAttribute("style",`background-color: ${chapter_colours[e-1]};`),n.appendChild(document.createTextNode(e))}else n=document.createTextNode(t[a]);e.appendChild(n)}g.appendChild(e),g.appendChild(document.createTextNode("\n"))}let t=new DocumentFragment,n=e.replace(/@(.*)/,"").replace(/#/g,"\n\n").split(/(\*+|\?\!)/),a=n.length;n[a-1]=n[a-1]+"\n";for(let e=0;e<a;e++){if(!SHOW.annotation&&/\*/.test(n[e]))continue;let a="";/\*/.test(n[e])?(a=document.createElement("sup"),a.appendChild(document.createTextNode(`[${n[e].length}]`)),a.setAttribute("style",`color: ${chapter_colours[h]}`)):a=/\?\!/.test(n[e])?document.createTextNode("‽"):document.createTextNode(n[e]),t.appendChild(a)}g.prepend(document.createTextNode("\n")),g.prepend(t)}if(s.setAttribute("style",`color: white;\n      background-color: ${chapter_colours[h]};\n      width: fit-content;\n      width: -moz-fit-content;\n      min-width: 2.2rem;\n      margin: 0 auto;\n      padding: 0.4rem 0.8rem;\n      border-radius: 24px;\n      line-height: 2.2rem;`),d.setAttribute("class","button_big"),d.setAttribute("style",`background-color: ${chapter_colours[h]};`),c.appendChild(l),SHOW.original&&c.appendChild(m),SHOW.translation&&c.appendChild(g),SHOW.annotation&&("Guodian"===order&&p<32||"Mawangdui"===order)){let e=document.createElement("small"),t=`${order}: ${"Guodian"===order&&p>13?p+1:p}\n\n`;e.appendChild(document.createTextNode(t)),e.setAttribute("style","text-align: center"),c.appendChild(e)}o.appendChild(c),a[n].appendChild(o),!(i%t)&&i<e&&(n++,a[n].setAttribute("class","contained"))}let i=document.createElement("form"),o=document.createElement("div"),r=document.createElement("div"),s=document.createElement("label"),l=document.createElement("label"),d=document.createElement("label"),c=document.createElement("label");s.appendChild(document.createTextNode("[]")),l.appendChild(document.createTextNode("English")),d.appendChild(document.createTextNode("中文")),c.appendChild(document.createTextNode("pīnyīn")),s.setAttribute("id","annotation"),l.setAttribute("id","translation"),d.setAttribute("id","original"),c.setAttribute("id","pinyin"),s.setAttribute("style",`font-weight: ${SHOW.annotation?"bold":"normal"};`),l.setAttribute("style",`font-weight: ${SHOW.translation?"bold":"normal"};`),d.setAttribute("style",`font-weight: ${SHOW.original?"bold":"normal"};`),c.setAttribute("style",`font-weight: ${SHOW.pinyin?"bold":"normal"};`),s.setAttribute("title","annotation"),l.setAttribute("title","translation"),d.setAttribute("title","original"),c.setAttribute("title","pinyin"),r.appendChild(document.createTextNode("Showing for each chapter")),i.appendChild(r),i.appendChild(d),i.appendChild(c),i.appendChild(l),i.appendChild(s),i.setAttribute("style","padding: 8rem 1rem 11rem;"),i.addEventListener("click",e=>{let t=e.target.id;SHOW[t]=!SHOW[t],redraw_all()}),o.appendChild(i),o.setAttribute("class","contained"),a[0].prepend(o);let h=document.createElement("div");h.setAttribute("class","page_sections"),h.appendChild(document.createTextNode("\n")),h.appendChild(array_to_anchors(section_anchors)),h.appendChild(document.createTextNode("\n")),a[0].prepend(h);let u=document.createElement("div"),p=make_chapter_table([CHAPTER_ARRAY,width,Math.ceil((MAX+1)/width)]);u.setAttribute("class","chapter_table"),u.setAttribute("style","padding: 1rem 1rem 0"),u.appendChild(p),a[0].prepend(u);let m=make_sorter();m.setAttribute("style","padding-top: 6rem;"),a[0].prepend(m);let g=document.createElement("h2");g.appendChild(document.createTextNode("Chapters\n\n")),a[0].prepend(g);let b=document.createElement("div"),f=make_menu();b.setAttribute("id","menu"),b.setAttribute("class","static"),b.appendChild(f),b.addEventListener("click",e=>e.stopPropagation()),a[0].prepend(b);let y=document.createElement("div");y.setAttribute("id","background"),y.setAttribute("class","inner border"),y.innerHTML=`<h2>Background</h2>\n  <h4 class="clicktoopen" onclick="toggle_sibling(event)">What is the correct way of spelling Laozi?</h4><div style="padding: 1.1rem 0; display: none;"><p>Laotzu, Laotzyy, Laozi are all romanisations of the same sequence of characters, 老子 - none is more correct than others. The Pinyin spelling has been chosen on the basis that Pinyin is currently the most widely taught and supported romanisation system.\n\n<table class="small_table">\n  <tr><th>Original</th><td>老子</td><td>道德經</td><td>天地</td></tr>\n  <tr><th>Wade-Giles</th><td>lao3 tzu3</td><td>tao4 te2 ching1</td><td>t'ien1 ti4</td></tr>\n  <tr><th>Gwoyeu romatzyh</th><td>lao tzyy</td><td>daw der jing</td><td>tian dih</td></tr>\n  <tr><th>Hanyu pinyin</th><td>lǎo zǐ</td><td>dào dé jīng</td><td>tiān dì</td></tr>\n  <tr><th>Translation</th><td>Master Lao\n/\nThe elder masters.</td><td>Classical Texts on Path & Virtuosity\n/\nClassic on Virtuosity in the Path.</td><td>The heaven and the earth.</td></tr></table></div><h4 class="clicktoopen" onclick="toggle_sibling(event)">Did Laozi really sound like that?</h4><div style="padding: 1.1rem 0; display: none;"><p>Since Laozi was written in a time when Old Chinese was spoken, it probably sounded a lot closer to Southern Min or Hokkien than Mandarin. Fortunately, there has not been so much divergence that the intended levity and lyricism are completely lost - most of the important homophonic puns do work in Mandarin.</p></div><h4 class="clicktoopen" onclick="toggle_sibling(event)">Your original text looks a little different from mine</h4><div style="padding: 1.1rem 0; display: none;"><p>This version happens to be a reconstruction by Fu Yi (傅奕, a grand historian in the Tang dynasty) from the earliest surviving copy of Laozi known to him. This copy was reportedly excavated in 574 from the tomb of Consort Yu (虞姬, birth name unknown), spouse of Xiang Yu (項羽). It shares a little more textual familiarity with the oldest verifiable copies than other received texts.</p></div><h4 class="clicktoopen" onclick="toggle_sibling(event)">How do I work out the strain used by the translation I am reading?</h4><div style="padding: 1.1rem 0; display: none;"><p>The copies of archaeological importance are Guodian Chujian (郭店楚簡), Mawangdui Boshu (馬王堆帛書), and Beida Hanjian (北大漢簡).\n\n  The editions in circulation are Fu Yi, Wang Bi, and Heshanggong (河上公). The current form of Wang Bi more closely resembles Heshanggong than the source material used by the commentary itself. Within each edition exist multiple versions that differ slightly from one another.\n\n  Narrowing down to variations substantial enough to be picked up in translation and assuming there is no pick-and-mixing of chapters and free insertion of words, you can find your version by going down this series of elimination:\n\n  <a class="button_small" href="#19" style="background-color: ${chapter_colours[18]}">19</a> / Guodian: 1\n  The third of the three statements is 'The forgoing of hypocrisy and the forsaking of deceit lead to the citizens falling back on piety and compassion'. The statement with 'robbers and thieves' precedes the one that ends with 'piety and compassion'.\n  <b>Guodian</b>\n\n  <a class="button_small" href="#2" style="background-color: ${chapter_colours[1]}">2</a> / Mawangdui: 46\n  Reference to that which activates or that which is an act of is absent: 'All understands goodness and therefore conceives of ungoodness.'\n  <b>Mawangdui</b> (and not Beida or the received texts)\n\n  <a class="button_small" href="#23" style="background-color: ${chapter_colours[22]}">23</a> / Beida: 64\n  After 'that which practises losing may attain unity by losing', it should read: 'The unity attained by the path is as such because one also stands to gain from the path. The unity attained by losing is as such because one also stands to lose from the path.'\n  <b>Beida</b> (and not the received texts)\n\n  <a class="button_small" href="#69" style="background-color: ${chapter_colours[68]}">69</a>\n  Rather than 'regarding opposers with levity', 'No misfortune is as great as being deprived of opposers.'\n  <b>Fu Yi</b> (and not the rest of the received texts)\n\n  <a class="button_small" href="#32" style="background-color: ${chapter_colours[31]}">32</a>\n  The first statement omits reference to plainness and smallness: 'The path is constantly without name and can be ruled by nothing under the heaven.'\n  <b>Wang Bi</b> (and not Heshanggong)</p></div>\n  </div>`,a[0].append(y);let _=document.createElement("div");_.setAttribute("id","interpretation"),_.setAttribute("class","inner border"),_.innerHTML=`<h2>Interpretation</h2>\n  <h4 class="clicktoopen" onclick="toggle_sibling(event)">How do Penrose stairs work as an analogy to Laozi's path?</h4><div style="padding: 1.1rem 0; display: none;">\n<table class="small_table"><tr><th>道</th><th>Penrose stairs</th></tr><tr><td>道可道 非常道\n  名可名 非常名\n  <a class="button_small" href="#1" style="background-color: ${chapter_colours[0]}">1</a></td><td>Cannot be expressed adequately in physical terms.</td><tr><td>故有 無之相生\n  難 易之相成\n  <a class="button_small" href="#2" style="background-color: ${chapter_colours[1]}">2</a></td><td>Shows the interdependence between direct opposites, which are meaningless without each other.</td><tr><td>吾不知其名 故彊字之曰道 彊為之名曰大\n  大曰逝 逝曰遠 遠曰返\n  <a class="button_small" href="#25" style="background-color: ${chapter_colours[24]}">25</a></td><td>Imagines an impossibly big loop by generalising negation to one fixed direction in space and leading somehow back to the source.</td><tr><td>故善人者 不善人之師 \n  不善人者 善人之資\n  <a class="button_small" href="#27" style="background-color: ${chapter_colours[26]}">27</a></td><td>Describes the absence of hierarchy between direct opposites, which are given equal prominence.</td><tr><td>明道若昧 夷道若纇 進道若退\n  <a class="button_small" href="#41" style="background-color: ${chapter_colours[40]}">41</a></td><td>Bears the features of a literal path.</td><tr></tr><td>禍兮 福之所倚\n  福兮 禍之所伏\n  孰知其極\n  其無正 袤正復為奇 善復為䄏\n  <a class="button_small" href="#58" style="background-color: ${chapter_colours[57]}">58</a></td><td>Draws no absolute boundaries - points on the loop being defined by their relative difference.</td><tr></table>\n\n<h5>Non-having & having\n\n</h5><p style="font-size: 1.1rem; text-align: center;">Conventional and finite:\nHaving is <s>not not</s> having. <i>Not having</i> is <s>not not</s> <i>not having</i>.\n\nParadoxical and infinite:\nHaving is <i>not having</i> is <s>not not</s> having is <s>not not</s> <i>not having</i> is <s>not not not not</s> having...</p>\n\n<h5>Generalisation\n\n</h5><div id="having" style="height: 23rem;"><div><table class="small_table" style="text-align: center;"><tr><td></td><td>To</td><td>have action</td><tr><td>is</td><td>to not</td><td>have action</td></tr><tr><td>is</td><td>to <s>not not</s></td><td>have action</td></tr></table>\n為無為則無不為矣\n<a class="button_small" href="#3" style="background-color: ${chapter_colours[2]}">3</a>\n\n</div></div></div><h4 class="clicktoopen" onclick="toggle_sibling(event)">How does virtuosity relate to the path?</h4><div style="padding: 1.1rem 0; display: none;">\n<h5>To attain & to gain\n\n</h5><table class="small_table">\n  <tr><th>其</th><th>德</th><th>得</th></tr><tr><th>無</th><td>得</td><td>德</td></tr><tr><th>有</th><td>德</td><td>得</td></tr></table>\n\n<h5>Sufficiency & authenticity\n\n</h5><table class="small_table"><tr><th></th><th>有</th><th>無</th></tr><tr><th>德</th><td>足:\n為天下谷 常德乃足 復歸於樸\n  <a class="button_small" href="#28" style="background-color: ${chapter_colours[27]}">28</a></td><td>信:\n上德不德 是以有德\n  <a class="button_small" href="#38" style="background-color: ${chapter_colours[37]}">38</a></td></tr><tr><th>得</th><td>信:\n不信者 吾亦信之 得信矣\n  <a class="button_small" href="#49" style="backgrouall thosend-color: ${chapter_colours[48]}">49</a></td><td>足:\n咎莫憯於欲得\n  <a class="button_small" href="#25" style="background-color: ${chapter_colours[24]}">25</a></td></tr></table>\n\n<h5>Non-action & action\n\n</h5><table class="small_table">\n  <tr><th>為</th><th>德</th><th>得</th></tr><tr><th>無</th><td>To attain substantially\nis to understand authenticity\nand to understand sufficiency</td><td>To gain substantially\nis to understand sufficiency\nand to understand authenticity</td></tr><tr><th>有</th><td>To attain negligibly\nis to not understand authenticity\nand to understand sufficiency</td><td>To gain negligibly\nis to not understand sufficiency\nand to understand authenticity</td></tr></table>\n\n<h5>Generalisation\n\n</h5><div id="virtue" style="height: 23rem;"><div><table class="small_table" style="text-align: center;"><tr><td></td><td>To</td><td>attain</td><tr><td>is</td><td>to not</td><td>attain</td></tr><tr><td>is</td><td>to <s>not not</s></td><td>attain</td></tr><tr><td>authentically</td></tr></table>\n德以盜德 信矣</div></div></div>\n`,a[0].append(_);let v=document.createElement("div");v.setAttribute("id","secular"),v.setAttribute("class","inner border"),v.innerHTML='<h2>Secularisation</h2>\n  <h4 class="clicktoopen" onclick="toggle_sibling(event)">Does Laozi condone the condemnation of religious practices?</h4><div style="padding: 1.1rem 0; display: none;"><p>No, Laozi maintains a respectful stance and advocates the co-existence of differing views provided that such views do not incur any harm. Passages on the preservation of the distinction between ghosts and gods and of the comfort-taking of the people in their traditions specifically speak to religious acceptance and freedom regardless of one\'s own persuasions.\n\nLaozi anticipates the stifling of religious expression by the authority - which goes against the teachings based on humility, imperturbability, open-mindedness, maximal inclusivity - the result of which leads to the deprivation of the people of its many benefits.\n\nFor many, religion is a major and sustainable source of self-fulfilment which they would otherwise seek from unhealthy activities. For many, religious presence - in the form of exercises and sermons, for example - provides social and cultural nourishment, psychological and physical betterment, dietary and philosophical guidance.</p></div><h4 class="clicktoopen" onclick="toggle_sibling(event)">Is it disrespectful to Chinese culture to read Laozi without spiritualism?</h4><div style="padding: 1.1rem 0; display: none;"><p>No, a healthy number of Chinese sceptics have existed alongside the development of Daoism, which gradually assimilated the longevity and immortality rituals and the folklore and cosmology of shamans (巫) and formula-bearing specialists (方士). The following quotes Gu Yong (谷永, minister to Emperor Cheng of Han):\n\n  <small>All those occultists, who turn their backs on the right path of benevolence and correct duty, who do not revere the model of the Five Classics but who rather are brimming with claims about the strange and marvelous, about spirits and ghosts, who stand in unquestioning reverence of the sacrificial practices of every locale, who seek rewards from shrines without good fortune to offer, who say that immortals are to be found in this world and who imbibe all manner of longevity drugs, who capriciously set out on distant quests and travel so high that their shadows are cast upwards, [i. e., fly over the top of the sun], who scan the world for Hsien-p\'u and drift about in search of P\'eng-lai, who rotate the planting of grain in mysterious conjunction with the Five Powers, and who sow and reap in cadence with the daily sun, who rival the mountain\'s stones in longevity, who have mastered the transformation of base metal to gold, who have made uniform the five colors and five stores within their bodies - those occultists cheat people and delude the masses.\n\n<b>Doctors, Diviners, and Magicians of Ancient China: Biographies of Fang-shih, page 38 - Kenneth J. DeWoskin</b>\n\n</small>\n  The following speaks of the prevalence of magical thinking and Fu Yi\'s attitude towards it some 600 years later:\n\n  <small>Prior to his death, he warned his children, \'The chapters of profound unity within Lao and Zhuang and the doctrines within the Six Classics of Zhou and Kong are renowned teachings - you should study those. The demonic and barbaric corruption of Chinese principles that is being promoted serve only to misguide the masses. I alone sigh hushedly; the masses, tragically, do not see it as I do - you should all refrain from learning from them! The ancients were buried bare - you should conduct yourselves accordingly.\' Fu Yi, in his life, never sought a doctor or took medicine for his illnesses. Despite having mastered the book of Yin Yang divination and numerology, he was not a believer.\n\n<b>Old Book of Tang, volume 79 - Liu Xu (舊唐書 - 劉昫)</b></small></p></div>\n  </div>',a[0].append(v);let w=document.createElement("div");w.setAttribute("id","subtitle"),w.setAttribute("class","center"),w.setAttribute("style",`color: ${dark_mode?"#404040":"#D8D8D8"};\n  z-index: -1;\n  font-size: 3rem;\n  cursor: default;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;`),a[0].append(w);let A=document.createElement("pre");return A.appendChild(document.createTextNode(stairs1)),A.setAttribute("id","art"),A.setAttribute("class","center"),A.setAttribute("style",`color: ${dark_mode?"#404040":"#D8D8D8"};\n  z-index: -1;\n  font-size: 5px;\n  line-height: 7px;\n  letter-spacing: 0;\n  cursor: default;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;`),a[0].append(A),a}function make_menu(){let e=document.createElement("div"),t=document.createElement("div");t.appendChild(array_to_anchors(main_anchors)),e.setAttribute("class","horizontal_menu"),e.setAttribute("id","top_horizontal"),e.appendChild(t);let n=document.createElement("div"),a=make_chapter_table([CHAPTER_ARRAY,width,Math.ceil((MAX+1)/width)]);n.setAttribute("class","chapter_table"),n.appendChild(a);let i=document.createElement("div"),o=document.createElement("div");o.appendChild(array_to_anchors(section_anchors)),i.setAttribute("class","horizontal_menu"),i.setAttribute("id","bottom_horizontal"),i.appendChild(o),horizontal_drag(e),horizontal_drag(i);let r=document.createElement("div");return r.setAttribute("id","menu_inner"),r.setAttribute("class","round"),r.setAttribute("style",`background-color: ${dark_mode?"#1f1f1f":"white"};`),r.appendChild(e),r.appendChild(n),r.appendChild(i),r.appendChild(make_sorter()),r}function make_sorter(){let e=document.createElement("form"),t=document.createElement("select"),n=new DocumentFragment;return orders.forEach(e=>{let t=document.createElement("option");t.appendChild(document.createTextNode(e)),e===ORDER&&t.setAttribute("selected","selected"),n.appendChild(t)}),t.appendChild(n),e.appendChild(document.createTextNode(`Sorting by${GAP}`)),e.appendChild(t),e.addEventListener("change",change_order),e}function colourise_chapters(){const e=dark_mode?"#1f1f1f":"white",t=dark_mode?"white":"#1f1f1f";document.getElementById("fade").style.backgroundColor=e,document.body.style.backgroundColor=e,document.body.style.color=t,document.getElementById("dark").setAttribute("style",`filter: invert(${100*dark_mode}%);`);let n="";if(random_colours=random_order().map(e=>COLOURS[e]),n=random_colours[0],"word count"===order||"character count"===order)return void(chapter_colours=new Array(MAX).fill().map(()=>n));let a=[...new Set(material.map(e=>e[`${order}_sections`]))].sort();for(let e=0;e<MAX;e++){let t=material[e][`${order}_sections`];n="Guodian"!==order||"04 Absent upper (21)"!==t&&"05 Absent lower (29)"!==t?random_colours[a.indexOf(t)]:"dimgrey",chapter_colours[e]=n}}function load_buffer(e){let t=0;return new Promise(n=>{e in buffers&&n(buffers[e]);let a=new XMLHttpRequest,i=`sound/${e}.mp3`;a.open("GET",i,!0),a.responseType="arraybuffer",a.onload=(()=>{context.decodeAudioData(a.response,t=>{buffers[e]=t,n(t)},()=>{console.log("Buffer not loaded. To retry."),t++,t<10&&load_buffer(e)})}),a.send()})}function karaoke(e){const t=document.getElementById(e);t.setAttribute("style","font-weight: bold;\n  text-shadow: 0 0 1px;\n  "),setTimeout(()=>{t.setAttribute("style","font-weight: normal;")},100)}function subtitle(e){const t=document.getElementById("subtitle"),n=document.getElementById(e).textContent.substring(0,1);t.innerHTML=n,setTimeout(()=>{t.innerHTML=""},100)}function play(e,t=0,n,a){"suspended"===context.state&&context.resume();let i=context.createBufferSource();sources[t]=i,load_buffer(e).then(e=>{i.buffer=e,i.connect(context.destination),i.start(t,0,1),i.onended=(()=>{if(delete sources[t],n&&SHOW.original&&context.currentTime-t>0){const e=`${n}-${CHAPTERS[n][a]}`;karaoke(e)}if(n&&!read_one&&CHAPTERS[n].length-1===a&&material[n-1][order]<81&&context.currentTime-t>0){const e=material.findIndex(e=>e[order]===material[n-1][order]+1);location.href=`#${e+1}`,play_chapter(e)}})})}function stop_sound(){context.suspend().then(()=>{Object.keys(sources).forEach(e=>sources[e].stop()),context.resume()})}function play_sequence(e,t,n){if(Object.keys(sources).length)return void stop_sound();let a=e.split(" ");Promise.all([a.map(e=>load_buffer(e))]).then(()=>{let e=a.length,i=t.split("").map(Number),o=.2,r=1,s=context.currentTime+r;for(let t=0;t<e&&a[t];t++){let e=s+t*o;play(a[t],e,n,t);let r=i[t]-1;s+=r*o}})}function original_to_rhythm(e){let t=e.split(""),n="";for(let[e]of t.entries()){if(/\s/.test(t[e]))continue;let a=1;/\s/.test(t[e+1])&&(a++,/\s/.test(t[e+2])&&a++),n+=a}return n}function tone_to_accent(e){const t={a:["ā","á","ǎ","à"],o:["ō","ó","ǒ","ò"],e:["ē","é","ě","è"],i:["ī","í","ǐ","ì"],u:["ū","ú","ǔ","ù"]},n=e.slice(-1)-1;return e.replace(/[aoeiu]/,e=>t[e][n]).slice(0,-1)}function play_character(e,t){const n=tone_to_accent(glyphs.filter(t=>t.character===e)[0].pinyin),a=tone_to_accent(t),i=glyphs.filter(t=>t.character===e)[0].frequency_rank,o=i<270?"Common":i<540?"Less common":i<811?"Rare":"Absent";console.log(`Character: ${e}\nPinyin: ${n} (${a})\nRarity: ${i}/810 (${o})\nDefinition:\nhttps://www.zdic.net/hans/${e}\nhttps://ctext.org/dictionary.pl?if=en&char=${e}\nhttps://dict.baidu.com/s?wd=${e}\nhttps://en.wiktionary.org/wiki/${e}\nhttps://www.moedict.tw/'${e}`),play(t)}function play_chapter(e){let t=material[e],n=t.pinyin,a=original_to_rhythm(t.original),i=t.original.replace(/  /g,"\n"),o=t.translation.replace(/@(.*)/,"").replace(/#/g,"\n\n").replace(/(\*+)/g,""),r=chinese_number(e+1);console.log(`老子 〈傅奕古本 第${r}章〉\n\n${i}\n  \nLaozi (Fu Yi's Ancient Copy, Chapter ${e+1})\n\n${o}`),play_sequence(n,a,e+1)}function chinese_number(e){const t=["一","二","三","四","五","六","七","八","九","十"],n=t[9];e+="";let a=e.length>1?"1"!==e.substr(-2,1)?t[e.substr(-2,1)-1]+n:n:"",i="0"!==e.substr(-1,1)?t[e.substr(-1,1)-1]:"",o=a+i;return o}function replace_child(e,t){let n=document.getElementById(t);n.replaceChild(e,n.firstElementChild)}function redraw_all(){width=get_width(),colourise_chapters();for(let e=0;e<DIVISION;e++)e?replace_child(make_laozi()[e],`laozi${e+1}`):replace_child(make_laozi()[0],"chapters"),document.getElementById("fade").style.opacity=1,fade_in()}function change_order(e){ORDER=e.target.value,order=ORDER.replace(/.*: /,""),redraw_all(),menu_toggle(e)}function fade_in(){"0"!==document.getElementById("fade").style.opacity&&(document.getElementById("fade").style.opacity-=.01,requestAnimationFrame(fade_in))}function glitch(e){phase_step>PHASE_INTERVAL?(replace_child(title(0),"title"),phase_step=0):phase_step>STABLE_BAR&&e-last>UPDATE_INTERVAL&&(replace_child(title(random_number(4)),"title"),last=e),phase_step++,requestAnimationFrame(glitch)}function stairs(e){const t=document.getElementById("art");e-stairs_last>1e3&&(stairs_last=e,"P"===t.firstChild.wholeText[698]?t.innerHTML=stairs2:t.innerHTML=stairs1),requestAnimationFrame(stairs)}function having_table(e){function t(e,t,n){const a=chapter_colours[e-1],i=document.createElement("div");return i.innerHTML=`<table class="small_table" style="text-align: center;"><tr><td></td><td>To</td><td>have ${n}</td><tr><td>is</td><td>to not</td><td>have ${n}</td></tr><tr><td>is</td><td>to <s>not not</s></td><td>have ${n}</td></tr></table>\n${t}\n<a class="button_small" href="#${e}" style="background-color: ${a}">${e}</a>\n\n`,i}const n=[[3,"為無為則無不為矣","action"],[7,"不以其無私耶 故能成其私","self-benefit"],[38,"上德不德 是以有德","virtue"],[16,"凡物紜紜 各歸其根\n歸根曰靖 靖曰復命\n復命曰常 知常曰明","constancy"],[61,"或下以取 或下而取","conquest"],[63,"是以聖人猶難之 故終無難矣","ease"],[76,"故堅彊處下 柔弱處上","strength"],[4,"道盅而用之又不滿\n淵兮 似萬物之宗","significance"],[22,"古之所謂曲則全者 豈虛言也哉\n誠全而歸之","completion"],[2,"天下皆知美之為美斯惡已\n皆知善之為善斯不善已","unity"],[47,"其出镾遠 其知镾尟","occupation"],[37,"道常無為而無不為\n王侯若能守 萬物將自化","leadership"]];if(e-having_last>3e3){having_last=e,having_step=n.length-1>having_step?++having_step:0;const a=n[having_step];replace_child(t(a[0],a[1],a[2]),"having")}requestAnimationFrame(having_table)}function virtue_table(e){function t(e,t,n,a,i){const o=document.createElement("div");return o.innerHTML=`<table class="small_table" style="text-align: center;"><tr><td></td><td>To</td><td>${e}</td><tr><td>is</td><td>to not</td><td>${t}</td></tr><tr><td>is</td><td>to <s>not not</s></td><td>${n}</td></tr><tr><td>${a}</td></tr></table>\n${i}\n\n`,o}const n=[["attain","attain","attain","authentically","德以盜德 信矣"],["attain","gain","attain","sufficiently","德以道德 足矣"],["gain","attain","attain","authentically","德以盜得 信矣"],["gain","gain","attain","sufficiently","德以道得 足矣"],["attain","attain","gain","authentically","得以盜德 信矣"],["attain","gain","gain","sufficiently","得以道德 足矣"],["gain","attain","gain","authentically","得以盜得 信矣"],["gain","gain","gain","sufficiently","得以道得 足矣"]];if(e-virtue_last>6e3){virtue_last=e,virtue_step=7>virtue_step?++virtue_step:0;const a=n[virtue_step];replace_child(t(a[0],a[1],a[2],a[3],a[4]),"virtue")}requestAnimationFrame(virtue_table)}function to_chapter(e){e.preventDefault();let t=e.target.innerText.replace(/\s/g,"");location.href="?"===t?`#${random_number(MAX)+1}`:`#${t}`}function make_fold(){let e=document.createElement("div"),t=document.createElement("h1");t.appendChild(TBRLTable("老子","lao2 zi3",1)),e.appendChild(t);let n=document.createElement("h1");e.appendChild(n),n.setAttribute("id","title"),n.appendChild(title(0));let a=document.createElement("h1");a.appendChild(TBRLTable("五千言","wu3 qian1 yan2",1)),e.appendChild(a);let i=document.createElement("h1");i.appendChild(document.createTextNode("Laozi Recited")),i.setAttribute("style","margin: 3rem 0;"),e.appendChild(i);let o=document.createElement("img");o.setAttribute("src","xuan.svg"),o.setAttribute("alt","dark"),o.setAttribute("id","dark"),o.addEventListener("click",dark_toggle),o.addEventListener("mouseover",()=>o.setAttribute("style",`filter: invert(${100*dark_mode}%) drop-shadow(0 0 1px);`)),o.addEventListener("mouseleave",()=>o.setAttribute("style",`filter: invert(${100*dark_mode}%) drop-shadow(0 0 0);`)),e.appendChild(o);let r=document.createElement("p");r.setAttribute("style","text-align: center; font-size: 1rem; margin: 0 1rem 1rem;"),r.appendChild(document.createTextNode("Hop to any section from the bottom-right menu")),e.appendChild(r);let s=document.createElement("div");s.setAttribute("class","menu_icon round"),s.setAttribute("style","margin: 0 auto 4rem;"),s.appendChild(document.createTextNode("☰")),e.appendChild(s);let l=document.createElement("p");l.setAttribute("style","text-align: center; font-size: 1rem; margin: 0 1rem 1rem;"),l.appendChild(document.createTextNode("Press any big chapter button to stop a running audio")),e.appendChild(l);let d=document.createElement("h3"),c=document.createElement("div");d.setAttribute("style","padding: 0;"),c.setAttribute("class","button_big"),c.setAttribute("style",`background-color: ${random_colours[random_number(13)]};\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;`),c.appendChild(document.createTextNode("0")),d.appendChild(c),e.appendChild(d);let h=document.createElement("div"),u=array_to_anchors(main_anchors);h.setAttribute("class","page_sections"),h.setAttribute("style","padding-top: 8rem;"),h.appendChild(document.createTextNode("\n")),h.appendChild(u),h.appendChild(document.createTextNode("\n")),e.appendChild(h)
;let p=document.createElement("div");return p.setAttribute("class","inner border"),p.innerHTML="<h2>Reliability notes</h2>\n  <h4 class=\"clicktoopen\" onclick=\"toggle_sibling(event)\">For Mandarin learners</h4><ul style=\"display: none;\"><li>Laozi is a Classical Chinese text. Without a separate plan to ground your understanding of Mandarin alongside the use of this website, at best, you will be learning some 810 Chinese characters and using them in archaic syntax in limited situations.</li>\n  <li>The pronunciation of each word is context-specific - the same character appearing in a different sequence can have a different pronunciation due to a tone change or an alternative meaning. On a desktop browser, press F12 to open up the Console. Clicking on a word displays in the Console both the neutral Pinyin and the one associated with the audio in parenthesis.</li>\n  <li>As per the conventional treatment of Chinese texts, where there is an option for literary or vernacular pronunciation for a word, the literary one has been chosen.</li>\n  <li>This version of Laozi uses many loan characters, some of which are very archaic. Save for a few characters that are not modern-font-safe (949: 𧶀, 1228: 𠔃, 3772: 疏), they have not been substituted by other glyphs. The stabilised representation of a loan character can be found in its respective Zdic page linked to in the Console.</li>\n  <li>Where the pre-Qin meaning of a word is known, the word has been read in its older meaning in the translation.</li>\n  <li>Sorting by character count can give you better control over your exposure to new vocabulary.</li>\n  <li>Punctuation, being non-existent in the original, has to be inferred from the context. The exclamation mark reflects the use of an exclamatory particle. The question mark and the interrobang terminate questions and rhetorical questions respectively. The full stop and the colon complete neutral statements close-ended- and open-endedly. Within a statement, the semicolon separates binarily-related phrases; the comma separates dependent clauses; the dash separates independent clauses and also bookends parenthetical details.</li></ul><h4 class=\"clicktoopen\" onclick=\"toggle_sibling(event)\">For new readers</h4><ul style=\"display: none;\"><li>This translation hypothesises that, notwithstanding the later history of textual transformation, the received chapters have been conceived through the authorship of one body. The basis being that it is more plausible to consider a work of this brevity and consistency in style and ideas to have been the product of a single early source than the product of carefully coordinated co-authorship and compilation over a long period of time with limited means of communication.\n\nThis assumption shapes the reading of the text in a way that departs from others that take a different view, with some translations and commentaries either leaving internally conflicting interpretation unresolved or rejecting chapters outright.</li>\n  <li>Focusing of concepts has been prioritised over idiomaticity. For example, for '難得', 'difficult to gain' is preferred over 'valuable'. Difficulty and gaining, being significant motifs, benefit from being exposed and recognisable in the same form each time they appear.</li>\n  <li>Genericity has been maximised where possible. For example, in the appearances of '王', 'monarch' suffices contextually without specifying sex; in the appearances of '觀' where the association with sightedness is minimal and incidental, the more inclusive 'discern' is preferred.\n\nThe use of neutral pronouns reflects the applicability of the original statements in various scenarios and keeps with the emphasis on commonalities across individuals, bodies of authority, flora and fauna, animate and inanimate entities.</li>\n  <li>The language lends itself to multiple interpretation. Take for example a relatively textually stable expression, '渙若冰將釋', which attempts to describe the ancient practitioners of the path. Lin Yutang's 'Self-effacing, like ice beginning to melt' comments on the quality of self. Chan Wing-Tsit's 'Supple and pliant, like ice about to melt' likens the behaviour of the sages to that of water. Lau Din-Cheuk's 'Falling apart like the thawing ice' focuses on the quality of transience. They differ from one another without being incorrect because the original expression naturally captures all of those sentiments.\n\nThe flexibility of Chinese, especially in the terse manner that Laozi is written in, is such that - like music, which is able to capture the mood of an entire era in a clip of a few seconds - it is both a strength and a weakness; music, by relying on abstractness for its strength, being unfortunately imprecise as a documenting tool. As such, even translations by scholarly-minded giants can differ greatly from that of a philosopher as respected as Wang Bi (王弼), notably in his reasoned treatment of implicit subjects and objects and compounds.</li>\n  <li>Benign ambiguity has been preserved where possible. For example, the bidirectionality in '不殆' is reflected in the preference for 'free of any threat' over the less neutral 'without presenting any threat' or 'without being presented with any threat'.\n\nA more complex example can be found in the following, which anticipates an evolution of desire:\n\n  <small>王侯若能守 萬物將自化\n化而欲作 吾將鎮之以無名之樸\n...\n不欲以靖 天下將自定\n\n</small>\n  It is possible to read the expression of desire as being both bottom-up and top-down - the author being alive to both the general corruptibility of learnings which a transformation would entail and the exploitability of the inferior by the unvirtuous superior:\n\n  <small>使我介然有知 行於大道 惟施是畏\n大道甚夷而民好徑\n\n生而不有 為而不恃 長而不宰 是謂玄德\n\n</small>\n  Examples of translation without ambiguity - one explicitly bottom-up and the other explicitly top-down:\n\n  <small>If kings and barons can keep it,\nall things will transform spontaneously.\nIf, after transformation, they should desire to be active,\nI would restrain them with simplicity, which has no name.\n...\nBeing free of desires, it is tranquil.\nAnd the world will be at peace of its own accord.\n\n<b>Chan</b>\n\n</small>\n  <small>Should lords and princes be able to hold fast to it,\nThe myriad creatures will be transformed of their own accord.\nAfter they are transformed, should desire raise its head,\nI shall press it down with the weight of the nameless uncarved block.\n...\nAnd if I cease to desire and remain still,\nThe empire will be at peace of its own accord.\n\n<b>Lau</b></small></li>\n  <li>The translation constantly undergoes correction and refinement. Readers who find the translation in its current wording unacceptable are welcome to continue to use the website without it, be it as a pronunciation checker or a visualisation of alternative sorting orders.\n\nFor reading your favourite translation or making your own translation with, the closest to an interpretation-free experience can be achieved by turning off the translation.\n  </li></ul><h4 class=\"clicktoopen\" onclick=\"toggle_sibling(event)\">For spiritualists and Daoists</h4><ul style=\"display: none;\"><li>A reading of Laozi is not sufficient to give the reader a complete understanding of Daoism or make a Daoist of the reader. This is even so for the most religiously-informed reading that a well-versed modern practitioner can give - the teachings in Laozi represent only a small aspect of Daoism.\n\nDaoism, as it is known today, is a religion of about 2,000 years old. Daoists are exposed to, alongside the core texts, writings very different in scope, aim, and aesthetic to Laozi.</li>\n  <li>Along with the development of Daoism, various religious explanations have been formulated to facilitate the deciphering of the core texts. This translation does not incorporate those ideas which Laozi and Zhuangzi would not have been familiar with - this is not a Daoist translation.\n\nRather, it lays a cohesive basis on which ideas claimed in Laozi to already have been in existence for a very long time can be made sensible and practisable in the plainest sense. As such, spiritualists can engage with the reading on its own consistency and build their own ideas on these simplistic renderings to best suit their needs.\n\nFor example, 氣 - the now philosophically-loaded word - is read as simply mood. By relying on statements on composure (靖為躁君; 善戰者不怒) for support, 氣 can be read without controversy in all of the contexts it appears in as something that can be regulated internally without special knowledge to bring about maximum sustainability.</li></ul>\n  ",e.appendChild(p),e.setAttribute("class","contained"),e}function play_toggle(e){const t=document.getElementById("play_mode").innerHTML,n="One/<b>All</b>";document.getElementById("play_mode").innerHTML=t!==n?n:"<b>One</b>/All",read_one=!read_one}function menu_toggle(e){e.stopPropagation();const t=document.getElementById("menu");t.style.visibility="hidden"===t.style.visibility||""===t.style.visibility?"visible":"hidden"}function menu_hide(){const e=document.getElementById("menu");e.style.visibility="hidden"}function horizontal_drag(e){let t=!1,n=0,a=0;const i=i=>{i.preventDefault(),t=!0,e.setAttribute("style","cursor: grabbing;"),a=i.pageX-e.offsetLeft,n=e.scrollLeft},o=i=>{if(!t)return;i.preventDefault();const o=i.pageX-e.offsetLeft,r=o-a;e.scrollLeft=n-r},r=n=>{n.preventDefault(),t=!1,e.setAttribute("style","cursor: normal;")};e.addEventListener("mousedown",i),e.addEventListener("mousemove",o),e.addEventListener("mouseup",r),e.addEventListener("mouseleave",r)}function dark_toggle(){dark_mode=dark_mode?0:1,redraw_all()}function toggle_sibling(e){const t=e.target,n=e.target.nextElementSibling;"clicktoopen"===t.getAttribute("class")?t.setAttribute("class","clicktoclose"):t.setAttribute("class","clicktoopen"),n.style.display="none"===n.style.display||""===n.style.display?"block":"none"}const TBRLTable=(e,t,n,a)=>array_to_tbrl_table(string_to_justified_array(e,t,n),a),make_chapter_array=(e=1,t=82)=>Array(t-e+1).fill().map((t,n)=>e+n),random_number=e=>Math.floor(Math.random()*e),random_order=()=>{let e=13,t=13,n=[];for(let a=0;a<t;a++){let t=0;do{t=random_number(e)}while(n.includes(t));n.push(t)}return n},get_width=()=>{let e=9,t=8,n=Math.min(t,Math.floor((screen_width-320)/30));return e+n};let dark_mode=1,screen_width=320,width=9,timeout=0;const DELAY=10,UPDATE_INTERVAL=100,PHASE_INTERVAL=300,STABLE_BAR=200;let phase_step=0,last=0,stairs_last=0,having_last=0,having_step=0,virtue_last=0,virtue_step=0;const MAX=81,GAP=" ",SHOW={annotation:!0,translation:!0,original:!0,pinyin:!0},DIVISION=1,CHAPTERS=new Array(MAX),CHAPTER_ARRAY=make_chapter_array(),orders=["theme","word count","character count","<278 BCE: Guodian","<202 BCE: Fu Yi","<168 BCE: Mawangdui"];let ORDER=orders[4],order=ORDER.replace(/.*: /,""),section_anchors=[["#1",material[0]["Fu Yi_sections"].substring(3)],["#38",material[37]["Fu Yi_sections"].substring(3)]],main_anchors=[["#","Top"],["#chapters","Chapters"],["#background","Background"],["#interpretation","Interpretation"],["#secular","Secularisation"]],read_one=!1;const COLOURS=["#2e5a85","#375f52","#0052b9","#7b2bc3","#5f5566","#8c3c72","#7c4a4b","#4e3cda","#465875","#2a6233","#005f7c","#4f547c","#9a353a"];let context,random_colours=random_order().map(e=>COLOURS[e]),chapter_colours=[];try{context=new AudioContext({latencyHint:"interactive",sampleRate:22050})}catch(e){console.log("To enable audio in Firefox, type 'about:config' in your browser and set 'dom.webaudio.enabled' to 'true'")}let buffers={},sources={};window.addEventListener("resize",()=>{const e=window.innerWidth;screen_width!==e&&(screen_width=e,clearTimeout(timeout),timeout=setTimeout(()=>{redraw_all()},DELAY))}),window.addEventListener("DOMContentLoaded",()=>{const e=window.innerWidth;screen_width=e,redraw_all()}),replace_child(make_fold(),"fold"),redraw_all(),stairs(),glitch(),having_table(),virtue_table();
